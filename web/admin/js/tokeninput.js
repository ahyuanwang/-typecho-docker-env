!function(j){var c={method:"GET",contentType:"json",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",prePopulate:null,processPrePopulate:!1,idPrefix:"token-input-",resultsFormatter:function(o){return"<li>"+o[this.propertyToSearch]+"</li>"},tokenFormatter:function(o){return"<li><p>"+o[this.propertyToSearch]+"</p></li>"},onResult:null,onAdd:null,onDelete:null,onReady:null},p={tokenList:"token-input-list",token:"token-input-token",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token"},g=0,h=1,d=2,i=8,l=13,a=27,b=37,r=38,f=39,e=40,m=108,k=188,n={init:function(q,o){var s=j.extend({},c,o||{});return this.each(function(){j(this).data("tokenInputObject",new j.TokenList(this,q,s))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(o){return this.data("tokenInputObject").add(o),this},remove:function(o){return this.data("tokenInputObject").remove(o),this},get:function(){return this.data("tokenInputObject").getTokens()}};j.fn.tokenInput=function(o){return n[o]?n[o].apply(this,Array.prototype.slice.call(arguments,1)):n.init.apply(this,arguments)},j.TokenList=function(ad,J,ah){var U;"string"===j.type(J)||"function"===j.type(J)?(ah.url=J,U=z(),void 0===ah.crossDomain&&(-1===U.indexOf("://")?ah.crossDomain=!1:ah.crossDomain=location.href.split(/\/+/g)[1]!==U.split(/\/+/g)[1])):"object"==typeof J&&(ah.local_data=J),ah.classes?ah.classes=j.extend({},p,ah.classes):ah.theme?(ah.classes={},j.each(p,function(s,o){ah.classes[s]=o+"-"+ah.theme})):ah.classes=p;var Q,Z=[],M=0,W=new j.TokenList.Cache,O=j('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",ah.idPrefix+ad.id).focus(function(){null!==ah.tokenLimit&&ah.tokenLimit===M||ah.hintText&&(X.html("<p>"+ah.hintText+"</p>"),K())}).blur(function(){F(),j(this).val("")}).keydown(function(s){var o;switch(s.keyCode){case b:case f:case r:case e:if(j(this).val()){var u=null;return(u=s.keyCode===e||s.keyCode===f?j(P).next():j(P).prev()).length&&Y(u),!1}o=ac.prev(),u=ac.next(),o.length&&o.get(0)===I||u.length&&u.get(0)===I?s.keyCode===b||s.keyCode===r?E(j(I),g):E(j(I),h):s.keyCode!==b&&s.keyCode!==r||!o.length?s.keyCode!==f&&s.keyCode!==e||!u.length||q(j(u.get(0))):q(j(o.get(0)));break;case i:if(o=ac.prev(),!j(this).val().length){return I?(N(j(I)),af.change()):o.length&&q(j(o.get(0))),!1}1===j(this).val().length?F():setTimeout(function(){A()},5);break;case l:case m:case k:return P?(H(j(P).data("tokeninput")),af.change()):H(null),!1;case a:return F(),!0;default:String.fromCharCode(s.which)&&setTimeout(function(){A()},5)}}),af=j(ad).hide().val("").focus(function(){O.focus()}).blur(function(){O.blur()}),I=null,ae=0,P=null,aa=j("<ul />").addClass(ah.classes.tokenList).click(function(o){o=j(o.target).closest("li");o&&o.get(0)&&j.data(o.get(0),"tokeninput")?function(u){var s=I;I&&E(j(I),d);s===u.get(0)?E(u,d):q(u)}(o):(I&&E(j(I),d),O.focus())}).mouseover(function(o){o=j(o.target).closest("li");o&&I!==this&&o.addClass(ah.classes.highlightedToken)}).mouseout(function(o){o=j(o.target).closest("li");o&&I!==this&&o.removeClass(ah.classes.highlightedToken)}).insertBefore(af),ac=j("<li />").addClass(ah.classes.inputToken).appendTo(aa).append(O),X=j("<div>").addClass(ah.classes.dropdown).appendTo("body").hide();j("<tester/>").insertAfter(O).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:O.css("fontSize"),fontFamily:O.css("fontFamily"),fontWeight:O.css("fontWeight"),letterSpacing:O.css("letterSpacing"),whiteSpace:"nowrap"});af.val("");ad=ah.prePopulate||af.data("pre");function ab(){null!==ah.tokenLimit&&M>=ah.tokenLimit&&(O.hide(),F())}function V(s){var o=ah.tokenFormatter(s),o=j(o).addClass(ah.classes.token).insertBefore(ac);j("<span>"+ah.deleteText+"</span>").addClass(ah.classes.tokenDelete).appendTo(o).click(function(){return N(j(this).parent()),af.change(),!1});var u={id:s.id};return u[ah.propertyToSearch]=s[ah.propertyToSearch],j.data(o.get(0),"tokeninput",s),Z=Z.slice(0,ae).concat([u]).concat(Z.slice(ae)),ae++,G(Z,af),M+=1,null!==ah.tokenLimit&&M>=ah.tokenLimit&&(O.hide(),F()),o}function H(u){var s=ah.onAdd;if(!u&&0<O.val().length&&((u={id:O.val()})[ah.propertyToSearch]=O.val()),u){if(0<M&&ah.preventDuplicates){var t=null;if(aa.children().each(function(){var v=j(this),o=j.data(v.get(0),"tokeninput");if(o&&o.id===u.id){return t=v,!1}}),t){return q(t),ac.insertAfter(t),void O.focus()}}(null==ah.tokenLimit||M<ah.tokenLimit)&&(V(u),ab()),O.val(""),F(),j.isFunction(s)&&s.call(af,u)}}function q(o){o.addClass(ah.classes.selectedToken),I=o.get(0),O.val(""),F()}function E(s,o){s.removeClass(ah.classes.selectedToken),I=null,o===g?(ac.insertBefore(s),ae--):o===h?(ac.insertAfter(s),ae++):(ac.appendTo(aa),ae=M),O.focus()}function N(u){var s=j.data(u.get(0),"tokeninput"),w=ah.onDelete,v=u.prevAll().length;ae<v&&v--,u.remove(),I=null,O.focus(),Z=Z.slice(0,v).concat(Z.slice(v+1)),v<ae&&ae--,G(Z,af),--M,null!==ah.tokenLimit&&O.show().val("").focus(),j.isFunction(w)&&w.call(af,s)}function G(s,o){s=j.map(s,function(t){return t[ah.tokenValue]});o.val(s.join(ah.tokenDelimiter))}function F(){X.hide().empty(),P=null}function K(){X.css({position:"absolute",top:j(aa).offset().top+j(aa).outerHeight(),left:j(aa).offset().left,zindex:999}).show()}function B(s,o,u){return s.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+o+")(?![^<>]*>)(?![^&;]+;)","g"),(u=u,o.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+u+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")))}function ag(u,t){var s;t&&t.length?(X.empty(),s=j("<ul>").appendTo(X).mouseover(function(o){Y(j(o.target).closest("li"))}).mousedown(function(o){return H(j(o.target).closest("li").data("tokeninput")),af.change(),!1}).hide(),j.each(t,function(v,o){var w=B(w=ah.resultsFormatter(o),o[ah.propertyToSearch],u);w=j(w).appendTo(s),v%2?w.addClass(ah.classes.dropdownItem):w.addClass(ah.classes.dropdownItem2),0===v&&Y(w),j.data(w.get(0),"tokeninput",o)}),K(),ah.animateDropdown?s.slideDown("fast"):s.show()):ah.noResultsText&&(X.html("<p>"+ah.noResultsText+"</p>"),K())}function Y(o){o&&(P&&(j(P).removeClass(ah.classes.selectedDropdownItem),P=null),o.addClass(ah.classes.selectedDropdownItem),P=o.get(0))}function A(){var s=O.val(),o=s.toLowerCase();o&&o.length&&(I&&E(j(I),h),o.length>=ah.minChars?(ah.searchingText&&(X.html("<p>"+ah.searchingText+"</p>"),K()),clearTimeout(Q),Q=setTimeout(function(){!function(v,C){var y=C+z(),x=W.get(y);var u,w;x?ag(v,x):ah.url?(w=z(),u={data:{}},-1<w.indexOf("?")?(x=w.split("?"),u.url=x[0],x=x[1].split("&"),j.each(x,function(L,D){D=D.split("=");u.data[D[0]]=D[1]})):u.url=w,u.data[ah.queryParam]=v,u.type=ah.method,u.dataType=ah.contentType,ah.crossDomain&&(u.dataType="jsonp"),u.success=function(t){j.isFunction(ah.onResult)&&(t=ah.onResult.call(af,t,v,C)),W.add(y,ah.jsonContainer?t[ah.jsonContainer]:t),O.val().toLowerCase()===v&&ag(v,ah.jsonContainer?t[ah.jsonContainer]:t)},j.ajax(u)):ah.local_data&&(w=j.grep(ah.local_data,function(t){return -1<t[ah.propertyToSearch].toLowerCase().indexOf(v.toLowerCase())}),j.isFunction(ah.onResult)&&(w=ah.onResult.call(af,w,v,C)),W.add(y,w),ag(v,w))}(o,s)},ah.searchDelay)):F())}function z(){var o=ah.url;return"function"==typeof ah.url&&(o=ah.url.call()),o}ah.processPrePopulate&&j.isFunction(ah.onResult)&&(ad=ah.onResult.call(af,ad)),ad&&ad.length&&j.each(ad,function(s,o){V(o),ab()}),j.isFunction(ah.onReady)&&ah.onReady.call(),this.clear=function(){aa.children("li").each(function(){0===j(this).children("input").length&&N(j(this))})},this.add=function(o){H(o)},this.remove=function(s){aa.children("li").each(function(){if(0===j(this).children("input").length){var u,o=j(this).data("tokeninput"),v=!0;for(u in s){if(s[u]!==o[u]){v=!1;break}}v&&N(j(this))}})},this.getTokens=function(){return Z}},j.TokenList.Cache=function(s){var u=j.extend({max_size:500},s),t={},q=0;this.add=function(v,o){q>u.max_size&&(t={},q=0),t[v]||(q+=1),t[v]=o},this.get=function(o){return t[o]}}}(jQuery);