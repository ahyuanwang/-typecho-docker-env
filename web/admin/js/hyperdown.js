(function(){var q,h,r,j,n,o,a,i,l,p=[].slice;function m(){this.commonWhiteList="kbd|b|i|strong|em|sup|sub|br|code|del|a|hr|small",this.blockHtmlTags="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|address|form|fieldset|iframe|hr|legend|article|section|nav|aside|hgroup|header|footer|figcaption|svg|script|noscript",this.specialWhiteList={table:"table|tbody|thead|tfoot|tr|td|th"},this.hooks={},this.html=!1,this.line=!1,this.blockParsers=[["code",10],["shtml",20],["pre",30],["ahtml",40],["shr",50],["list",60],["math",70],["html",80],["footnote",90],["definition",100],["quote",110],["table",120],["sh",130],["mh",140],["dhr",150],["default",9999]],this.parsers={}}l=function(b){return b.charAt(0).toUpperCase()+b.substring(1)},o=function(b){return b.replace(/[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},n="A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",a=function(v,k,d){var w,b,f,g,c,u;if(v instanceof Array){if(k instanceof Array){for(w=b=0,g=v.length;b<g;w=++b){u=v[w],d=a(u,k[w],d)}}else{for(f=0,c=v.length;f<c;f++){u=v[f],d=a(u,k,d)}}}else{v=o(v),d=d.replace(new RegExp(v,"g"),k.replace(/\$/g,"$$$$"))}return d},j=function(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},i=function(d,k){var u,f,g,b,c;if(null==k&&(k=null),null==k){return d.replace(/^\s*/,"").replace(/\s*$/,"")}for(c="",f=g=0,b=k.length-1;0<=b?g<=b:b<=g;f=0<=b?++g:--g){u=k[f],c+=o(u)}return c="["+c+"]*",d.replace(new RegExp("^"+c),"").replace(new RegExp(c+"$"),"")},h=function(b){var f,g,c,d=[];if(b instanceof Array){for(g=f=0,c=b.length;f<c;g=++f){b[g],d.push(g)}}else{for(g in b){d.push(g)}}return d},r=function(c){var g,k,d,f,b=[];if(c instanceof Array){for(k=0,d=c.length;k<d;k++){f=c[k],b.push(f)}}else{for(g in c){f=c[g],b.push(f)}}return b},m.prototype.makeHtml=function(c){var g,k,d,f,b;for(this.footnotes=[],this.definitions={},this.holders={},this.uniqid=Math.ceil(10000000*Math.random())+Math.ceil(10000000*Math.random()),this.id=0,this.blockParsers.sort(function(s,u){return s[1]<u[1]?-1:1}),g=0,k=(b=this.blockParsers).length;g<k;g++){d=(f=b[g])[0],void 0!==f[2]?this.parsers[d]=f[2]:this.parsers[d]=this["parseBlock"+l(d)].bind(this)}return c=this.initText(c),c=this.parse(c),c=this.makeFootnotes(c),c=this.optimizeLines(c),this.call("makeHtml",c)},m.prototype.enableHtml=function(b){this.html=null==b||b},m.prototype.enableLine=function(b){this.line=null==b||b},m.prototype.hook=function(b,c){return null==this.hooks[b]&&(this.hooks[b]=[]),this.hooks[b].push(c)},m.prototype.makeHolder=function(b){var c="|\r"+this.uniqid+this.id+"\r|";return this.id+=1,this.holders[c]=b,c},m.prototype.initText=function(b){return b.replace(/\t/g,"    ").replace(/\r/g,"").replace(/(\u000A|\u000D|\u2028|\u2029)/g,"\n")},m.prototype.makeFootnotes=function(b){var c,d;if(0<this.footnotes.length){for(b+='<div class="footnotes"><hr><ol>',c=1;d=this.footnotes.shift();){"string"==typeof d?d+=' <a href="#fnref-'+c+'" class="footnote-backref">&#8617;</a>':(d[d.length-1]+=' <a href="#fnref-'+c+'" class="footnote-backref">&#8617;</a>',d=1<d.length?this.parse(d.join("\n")):this.parseInline(d[0])),b+='<li id="fn-'+c+'">'+d+"</li>",c+=1}b+="</ol></div>"}return b},m.prototype.parse=function(B,x,g){var C,b,k,v,f,z,y,w,d,A;for(null==x&&(x=!1),null==g&&(g=0),z=[],C=this.parseBlock(B,z),k="",x&&1===C.length&&"normal"===C[0][0]&&(C[0][3]=!0),v=0,f=C.length;v<f;v++){d=(b=C[v])[0],w=b[1],y=b[2],A=b[3],b=z.slice(w,y+1),d="parse"+l(d),b=this.call("before"+l(d),b,A),y=this[d](b,A,w+g,y+g),k+=this.call("after"+l(d),y,A)}return k},m.prototype.call=function(){var c,g,k,d=arguments[0],f=2<=arguments.length?p.call(arguments,1):[],b=f[0];if(null==this.hooks[d]){return b}for(c=0,g=(k=this.hooks[d]).length;c<g;c++){b=k[c].apply(this,f),f[0]=b}return b},m.prototype.releaseHolder=function(b,c){var d;for(null==c&&(c=!0),d=0;0<=b.indexOf("\r")&&d<10;){b=a(h(this.holders),r(this.holders),b),d+=1}return c&&(this.holders={}),b},m.prototype.markLine=function(b,c){return null==c&&(c=-1),this.line?'<span class="line" data-start="'+b+'" data-end="'+(c=c<0?b:c)+'" data-id="'+this.uniqid+'"></span>':""},m.prototype.markLines=function(b,d){var f,c=-1;return this.line?b.map((f=this,function(e){return c+=1,f.markLine(d+c)+e})):b},m.prototype.optimizeLines=function(b){var d=0,c=new RegExp('class="line" data\\-start="([0-9]+)" data\\-end="([0-9]+)" (data\\-id="'+this.uniqid+'")',"g");return this.line?b.replace(c,function(){var f=1<=arguments.length?p.call(arguments,0):[],g=d!==parseInt(f[1])?'class="line" data-start="'+d+'" data-start-original="'+f[1]+'" data-end="'+f[2]+'" '+f[3]:f[0];return d=1+parseInt(f[2]),g}):b},m.prototype.parseInline=function(G,C,v,H){var b,x,z,g,E,D,A,d,F,B,y,w;return null==C&&(C=""),null==v&&(v=!0),null==H&&(H=!0),G=(G=(G=(G=(G=(G=this.call("beforeParseInline",G)).replace(/(^|[^\\])(`+)(.+?)\2/gm,(b=this,function(){var c=1<=arguments.length?p.call(arguments,0):[];return c[1]+b.makeHolder("<code>"+j(c[3])+"</code>")}))).replace(/(^|[^\\])(\$+)(.+?)\2/gm,(x=this,function(){var c=1<=arguments.length?p.call(arguments,0):[];return c[1]+x.makeHolder(c[2]+j(c[3])+c[2])}))).replace(/\\(.)/g,(z=this,function(){var c=1<=arguments.length?p.call(arguments,0):[],f=c[1].match(/^[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]$/)?"":"\\",c=j(c[1]);return c=c.replace(/\$/g,"&dollar;"),z.makeHolder(f+c)}))).replace(/<(https?:\/\/.+)>/gi,(g=this,function(){var c=1<=arguments.length?p.call(arguments,0):[],f=g.cleanUrl(c[1]),c=g.call("parseLink",c[1]);return g.makeHolder('<a href="'+f+'">'+c+"</a>")}))).replace(/<(\/?)([a-z0-9-]+)(\s+[^>]*)?>/gi,(E=this,function(){var c=1<=arguments.length?p.call(arguments,0):[];return E.html||0<=("|"+E.commonWhiteList+"|"+C+"|").indexOf("|"+c[2].toLowerCase()+"|")?E.makeHolder(c[0]):E.makeHolder(j(c[0]))})),this.html&&(G=G.replace(/<!\-\-(.*?)\-\->/g,(D=this,function(){var c=1<=arguments.length?p.call(arguments,0):[];return D.makeHolder(c[0])}))),G=(G=(G=(G=(G=(G=a(["<",">"],["&lt;","&gt;"],G)).replace(/\[\^((?:[^\]]|\\\]|\\\[)+?)\]/g,(A=this,function(){var c=1<=arguments.length?p.call(arguments,0):[],f=A.footnotes.indexOf(c[1]);return f<0&&(f=A.footnotes.length+1,A.footnotes.push(A.parseInline(c[1],"",!1))),A.makeHolder('<sup id="fnref-'+f+'"><a href="#fn-'+f+'" class="footnote-ref">'+f+"</a></sup>")}))).replace(/!\[((?:[^\]]|\\\]|\\\[)*?)\]\(((?:[^\)]|\\\)|\\\()+?)\)/g,(d=this,function(){var c=1<=arguments.length?p.call(arguments,0):[],f=j(d.escapeBracket(c[1])),c=d.escapeBracket(c[2]);return c=d.cleanUrl(c),d.makeHolder('<img src="'+c+'" alt="'+f+'" title="'+f+'">')}))).replace(/!\[((?:[^\]]|\\\]|\\\[)*?)\]\[((?:[^\]]|\\\]|\\\[)+?)\]/g,(F=this,function(){var c=1<=arguments.length?p.call(arguments,0):[],f=j(F.escapeBracket(c[1])),f=null!=F.definitions[c[2]]?'<img src="'+F.definitions[c[2]]+'" alt="'+f+'" title="'+f+'">':f;return F.makeHolder(f)}))).replace(/\[((?:[^\]]|\\\]|\\\[)+?)\]\(((?:[^\)]|\\\)|\\\()+?)\)/g,(B=this,function(){var c=1<=arguments.length?p.call(arguments,0):[],f=B.parseInline(B.escapeBracket(c[1]),"",!1,!1),c=B.escapeBracket(c[2]);return c=B.cleanUrl(c),B.makeHolder('<a href="'+c+'">'+f+"</a>")}))).replace(/\[((?:[^\]]|\\\]|\\\[)+?)\]\[((?:[^\]]|\\\]|\\\[)+?)\]/g,(y=this,function(){var c=1<=arguments.length?p.call(arguments,0):[],f=y.parseInline(y.escapeBracket(c[1]),"",!1,!1),f=null!=y.definitions[c[2]]?'<a href="'+y.definitions[c[2]]+'">'+f+"</a>":f;return y.makeHolder(f)})),G=(G=this.parseInlineCallback(G)).replace(/<([_a-z0-9-\.\+]+@[^@]+\.[a-z]{2,})>/gi,'<a href="mailto:$1">$1</a>'),H&&(H=new RegExp('(^|[^"])((https?):['+n+'_0-9-\\./%#!@\\?\\+=~\\|\\,&\\(\\)]+)($|[^"])',"ig"),G=G.replace(H,(w=this,function(){var c=1<=arguments.length?p.call(arguments,0):[],f=w.call("parseLink",c[2]);return c[1]+'<a href="'+c[2]+'">'+f+"</a>"+c[4]}))),G=this.call("afterParseInlineBeforeRelease",G),G=this.releaseHolder(G,v),G=this.call("afterParseInline",G)},m.prototype.parseInlineCallback=function(d){var k,v,f,g,b,c,u;return d=(d=(d=(d=(d=(d=(d=d.replace(/(\*{3})((?:.|\r)+?)\1/gm,(k=this,function(){var e=1<=arguments.length?p.call(arguments,0):[];return"<strong><em>"+k.parseInlineCallback(e[2])+"</em></strong>"}))).replace(/(\*{2})((?:.|\r)+?)\1/gm,(v=this,function(){var e=1<=arguments.length?p.call(arguments,0):[];return"<strong>"+v.parseInlineCallback(e[2])+"</strong>"}))).replace(/(\*)((?:.|\r)+?)\1/gm,(f=this,function(){var e=1<=arguments.length?p.call(arguments,0):[];return"<em>"+f.parseInlineCallback(e[2])+"</em>"}))).replace(/(\s+|^)(_{3})((?:.|\r)+?)\2(\s+|$)/gm,(g=this,function(){var e=1<=arguments.length?p.call(arguments,0):[];return e[1]+"<strong><em>"+g.parseInlineCallback(e[3])+"</em></strong>"+e[4]}))).replace(/(\s+|^)(_{2})((?:.|\r)+?)\2(\s+|$)/gm,(b=this,function(){var e=1<=arguments.length?p.call(arguments,0):[];return e[1]+"<strong>"+b.parseInlineCallback(e[3])+"</strong>"+e[4]}))).replace(/(\s+|^)(_)((?:.|\r)+?)\2(\s+|$)/gm,(c=this,function(){var e=1<=arguments.length?p.call(arguments,0):[];return e[1]+"<em>"+c.parseInlineCallback(e[3])+"</em>"+e[4]}))).replace(/(~{2})((?:.|\r)+?)\1/gm,(u=this,function(){var e=1<=arguments.length?p.call(arguments,0):[];return"<del>"+u.parseInlineCallback(e[2])+"</del>"}))},m.prototype.parseBlock=function(D,z){for(var k,E,b,v,w,g,B,A,x,d=D.split("\n"),C=0,y=d.length;C<y;C++){w=d[C],z.push(w)}for(this.blocks=[],this.current="normal",this.pos=-1,x={special:h(this.specialWhiteList).join("|"),empty:0,html:!1},E=b=0,v=z.length;b<v;E=++b){if(w=z[E],k=this.getBlock(),null!=k&&(k=k.slice(0)),"normal"===this.current||this.parsers[this.current](k,E,w,x,z)){for(g in A=this.parsers){if(B=A[g],g!==this.current&&!B(k,E,w,x,z)){break}}}}return this.optimizeBlocks(this.blocks,z)},m.prototype.parseBlockList=function(b,f,g,c){var d;if(this.isBlock("list")&&!g.match(/^\s*\[((?:[^\]]|\\\]|\\\[)+?)\]:\s*(.+)$/)){if(c.empty<=1&&(d=g.match(/^(\s+)/))&&d[1].length>b[3]){return c.empty=0,this.setBlock(f),!1}if(g.match(/^\s*$/)&&0===c.empty){return c.empty+=1,this.setBlock(f),!1}}return !(d=g.match(/^(\s*)((?:[0-9]+\.)|\-|\+|\*)\s+/i))||(d=d[1].length,c.empty=0,this.isBlock("list")?this.setBlock(f,d):this.startBlock("list",f,d),!1)},m.prototype.parseBlockCode=function(b,d,f){var c;return(f=f.match(/^(\s*)(~{3,}|`{3,})([^`~]*)$/i))?(this.isBlock("code")?(c=b[3][2])?this.combineBlock().setBlock(d):this.setBlock(d).endBlock():(c=!1,this.isBlock("list")&&(c=0<(b=b[3])&&f[1].length>=b||f[1].length>b),this.startBlock("code",d,[f[1],f[3],c])),!1):!this.isBlock("code")||(this.setBlock(d),!1)},m.prototype.parseBlockShtml=function(b,d,f,c){if(this.html){if(f.match(/^(\s*)!!!(\s*)$/)){return this.isBlock("shtml")?this.setBlock(d).endBlock():this.startBlock("shtml",d),!1}if(this.isBlock("shtml")){return this.setBlock(d),!1}}return !0},m.prototype.parseBlockAhtml=function(d,k,v,f){var g,b,c,u;if(this.html){if(u=new RegExp("^\\s*<("+this.blockHtmlTags+")(\\s+[^>]*)?>","i"),u=v.match(u)){if(this.isBlock("ahtml")){return this.setBlock(k),!1}if(void 0===u[2]||"/"!==u[2]){for(this.startBlock("ahtml",k),g=new RegExp("\\s*<("+this.blockHtmlTags+")(\\s+[^>]*)?>","ig");c=g.exec(v);){b=c[1]}return 0<=v.indexOf("</"+b+">")?this.endBlock():f.html=b,!1}}else{if(f.html&&0<=v.indexOf("</"+f.html+">")){return this.setBlock(k).endBlock(),f.html=!1}if(this.isBlock("ahtml")){return this.setBlock(k),!1}if(u=v.match(/^\s*<!\-\-(.*?)\-\->\s*$/)){return this.startBlock("ahtml",k).endBlock(),!1}}}return !0},m.prototype.parseBlockMath=function(b,c,d){return d.match(/^(\s*)\$\$(\s*)$/)?(this.isBlock("math")?this.setBlock(c).endBlock():this.startBlock("math",c),!1):!this.isBlock("math")||(this.setBlock(c),!1)},m.prototype.parseBlockPre=function(b,d,f,c){return f.match(/^ {4}/)?(this.isBlock("pre")?this.setBlock(d):this.startBlock("pre",d),!1):!this.isBlock("pre")||!f.match(/^\s*$/)||(this.setBlock(d),!1)},m.prototype.parseBlockHtml=function(c,g,k,d){var f,b;return(f=k.match(new RegExp("^\\s*<("+d.special+")(\\s+[^>]*)?>","i")))?(b=f[1].toLowerCase(),this.isBlock("html",b)||this.isBlock("pre")||this.startBlock("html",g,b),!1):(f=k.match(new RegExp("</("+d.special+")>\\s*$","i")))?(b=f[1].toLowerCase(),this.isBlock("html",b)&&this.setBlock(g).endBlock(),!1):!this.isBlock("html")||(this.setBlock(g),!1)},m.prototype.parseBlockFootnote=function(b,d,f){var c;return !(c=f.match(/^\[\^((?:[^\]]|\\\]|\\\[)+?)\]:/))||(f=c[0].length-1,this.startBlock("footnote",d,[f,c[1]]),!1)},m.prototype.parseBlockDefinition=function(b,c,d){return !(d=d.match(/^\s*\[((?:[^\]]|\\\]|\\\[)+?)\]:\s*(.+)$/))||(this.definitions[d[1]]=this.cleanUrl(d[2]),this.startBlock("definition",c).endBlock(),!1)},m.prototype.parseBlockQuote=function(b,c,d){return !(d=d.match(/^(\s*)>/))||(this.isBlock("list")&&0<d[1].length||this.isBlock("quote")?this.setBlock(c):this.startBlock("quote",c),!1)},m.prototype.parseBlockTable=function(y,v,f,z,b){var g,k,d,x,w,u;if(w=f.match(/^((?:(?:(?:\||\+)(?:[ :]*\-+[ :]*)(?:\||\+))|(?:(?:[ :]*\-+[ :]*)(?:\||\+)(?:[ :]*\-+[ :]*))|(?:(?:[ :]*\-+[ :]*)(?:\||\+))|(?:(?:\||\+)(?:[ :]*\-+[ :]*)))+)$/)){if(this.isBlock("table")){y[3][0].push(y[3][2]),y[3][2]+=1,this.setBlock(v,y[3])}else{for(f=0,null==y||"normal"!==y[0]||b[y[2]].match(/^\s*$/)?this.startBlock("table",v):(f=1,this.backBlock(1,"table")),"|"===w[1][0]&&(w[1]=w[1].substring(1),"|"===w[1][w[1].length-1]&&(w[1]=w[1].substring(0,w[1].length-1))),k=[],d=0,x=(u=w[1].split(/\+|\|/)).length;d<x;d++){g="none",(w=u[d].match(/^\s*(:?)\-+(:?)\s*$/))&&(w[1]&&w[2]?g="center":w[1]?g="left":w[2]&&(g="right")),k.push(g)}this.setBlock(v,[[f],k,f+1])}return !1}return !0},m.prototype.parseBlockSh=function(b,c,d){return !(d=d.match(/^(#+)(.*)$/))||(d=Math.min(d[1].length,6),this.startBlock("sh",c,d).endBlock(),!1)},m.prototype.parseBlockMh=function(b,f,g,c,d){return !((g=g.match(/^\s*((=|-){2,})\s*$/))&&null!=b&&"normal"===b[0]&&!d[b[2]].match(/^\s*$/))||(this.isBlock("normal")?this.backBlock(1,"mh","="===g[1][0]?1:2).setBlock(f).endBlock():this.startBlock("normal",f),!1)},m.prototype.parseBlockShr=function(b,c,d){return !d.match(/^(\* *){3,}\s*$/)||(this.startBlock("hr",c).endBlock(),!1)},m.prototype.parseBlockDhr=function(b,c,d){return !d.match(/^(- *){3,}\s*$/)||(this.startBlock("hr",c).endBlock(),!1)},m.prototype.parseBlockDefault=function(b,d,f,c){return this.isBlock("footnote")?f.match(/^(\s*)/)[1].length>=b[3][0]?this.setBlock(d):this.startBlock("normal",d):this.isBlock("table")?0<=f.indexOf("|")?(b[3][2]+=1,this.setBlock(d,b[3])):this.startBlock("normal",d):this.isBlock("quote")?f.match(/^(\s*)$/)?this.startBlock("normal",d):this.setBlock(d):null==b||"normal"!==b[0]?this.startBlock("normal",d):this.setBlock(d),!0},m.prototype.optimizeBlocks=function(z,w){var g,A,b,k,u,f,y,x,v=z.slice(0),d=w.slice(0);for(v=this.call("beforeOptimizeBlocks",v,d),b=0;null!=v[b];){k=!1,g=v[b],f=null!=v[b-1]?v[b-1]:null,u=null!=v[b+1]?v[b+1]:null,x=g[0],A=g[1],y=g[2],"pre"===x&&d.slice(g[1],g[2]+1).reduce(function(c,s){return s.match(/^\s*$/)&&c},!0)&&(g[0]=x="normal"),"normal"===x&&(x=["list","quote"],A===y&&d[A].match(/^\s*$/)&&null!=f&&null!=u&&f[0]===u[0]&&0<=x.indexOf(f[0])&&(v[b-1]=[f[0],f[1],u[2],null],v.splice(b,2),k=!0)),k||(b+=1)}return this.call("afterOptimizeBlocks",v,d)},m.prototype.parseCode=function(d,k,v){var f,g,b,c=k[0],u=k[1];return u=i(u),f=c.length,u.match(/^[_a-z0-9-\+\#\:\.]+$/i)?1<(k=u.split(":")).length&&(u=k[0],b=k[1],u=i(u),b=i(b)):u=null,g=!0,d=d.slice(1,-1).map(function(e){return e=e.replace(new RegExp("/^[ ]{"+f+"}/"),""),g&&!e.match(/^\s*$/)&&(g=!1),j(e)}),v=this.markLines(d,v+1).join("\n"),g?"":"<pre><code"+(u?' class="'+u+'"':"")+(b?' rel="'+b+'"':"")+">"+v+"</code></pre>"},m.prototype.parsePre=function(b,c,d){return b=b.map(function(e){return j(e.substring(4))}),(d=this.markLines(b,d).join("\n")).match(/^\s*$/)?"":"<pre><code>"+d+"</code></pre>"},m.prototype.parseAhtml=function(b,c,d){return i(this.markLines(b,d).join("\n"))},m.prototype.parseShtml=function(b,c,d){return i(this.markLines(b.slice(1,-1),d+1).join("\n"))},m.prototype.parseMath=function(b,d,f,c){return"<p>"+this.markLine(f,c)+j(b.join("\n"))+"</p>"},m.prototype.parseSh=function(b,d,f,c){b=this.markLine(f,c)+this.parseInline(i(b[0],"# "));return b.match(/^\s*$/)?"":"<h"+d+">"+b+"</h"+d+">"},m.prototype.parseMh=function(b,d,f,c){return this.parseSh(b,d,f,c)},m.prototype.parseQuote=function(b,c,d){return(b=(b=b.map(function(e){return e.replace(/^\s*> ?/,"")})).join("\n")).match(/^\s*$/)?"":"<blockquote>"+this.parse(b,!0,d)+"</blockquote>"},m.prototype.parseList=function(C,Q,I){for(var D,E,K,M,H,U,S,N,G,A,P,L,J="",O=99999,R=99999,F=!1,T=!1,x=[],z=D=0,w=C.length;D<w;z=++D){(N=(S=C[z]).match(/^(\s*)((?:[0-9]+\.?)|\-|\+|\*)(\s+)(.*)$/i))?(A=N[1].length,L=0<="+-*".indexOf(N[2])?"ul":"ol",O=Math.min(A,O),F=!0,0<A&&(R=Math.min(A,R),T=!0),x.push([A,L,S,N[4]])):(x.push(S),(N=S.match(/^(\s*)/))&&0<(A=N[1].length)&&(R=Math.min(A,R),T=!0))}for(O=F?O:0,R=T?R:O,K="",M=[],z=E=H=0,U=x.length;E<U;z=++E){(G=x[z]) instanceof Array?(A=G[0],L=G[1],S=G[2],P=G[3],A!==O?M.push(S.replace(new RegExp("^\\s{"+R+"}"),"")):(0<M.length&&(J+="<li>"+this.parse(M.join("\n"),!0,I+H)+"</li>"),K!==L&&(K&&(J+="</"+K+">"),J+="<"+L+">"),H=z,M=[P],K=L)):M.push(G.replace(new RegExp("^\\s{"+R+"}"),""))}return 0<M.length&&(J+="<li>"+this.parse(M.join("\n"),!0,I+H)+"</li></"+K+">"),J},m.prototype.parseTable=function(A,P,H){for(var C,D,J,L,G,T,R,M,F,z,O,K=P[0],I=P[1],N=0<K.length&&0<K.reduce(function(b,c){return c+b}),Q="<table>",E=!N||null,S=!1,w=D=0,x=A.length;D<x;w=++D){if(T=A[w],0<=K.indexOf(w)){N&&S&&(E=!(N=!1))}else{for(S=!0,"|"===(T=i(T))[0]&&"|"===(T=T.substring(1))[T.length-1]&&(T=T.substring(0,T.length-1)),C={},L=-1,J=0,G=(F=T.split("|").map(function(b){return b.match(/^\s*$/)?" ":i(b)})).length;J<G;J++){0<(M=F[J]).length?C[L+=1]=[null!=C[L]?C[L][0]+1:1,M]:null!=C[L]?C[L][0]+=1:C[0]=[1,M]}for(w in N?Q+="<thead>":E&&(Q+="<tbody>"),Q+="<tr",this.line&&(Q+=' class="line" data-start="'+(H+w)+'" data-end="'+(H+w)+'" data-id="'+this.uniqid+'"'),Q+=">",C){R=(z=C[w])[0],O=z[1],Q+="<"+(z=N?"th":"td"),1<R&&(Q+=' colspan="'+R+'"'),null!=I[w]&&"none"!==I[w]&&(Q+=' align="'+I[w]+'"'),Q+=">"+this.parseInline(O)+"</"+z+">"}Q+="</tr>",N?Q+="</thead>":E=E&&!1}}return null!==E&&(Q+="</tbody>"),Q+"</table>"},m.prototype.parseHr=function(b,c,d){return this.line?'<hr class="line" data-start="'+d+'" data-end="'+d+'">':"<hr>"},m.prototype.parseNormal=function(b,f,g){var c,d;return null==f&&(f=!1),c=0,b=b.map((d=this,function(e){return(e=d.parseInline(e)).match(/^\s*$/)||(e=d.markLine(g+c)+e),c+=1,e})),(b=(b=(b=i(b.join("\n"))).replace(/(\n\s*){2,}/g,"</p><p>")).replace(/\n/g,"<br>")).match(/^\s*$/)?"":f?b:"<p>"+b+"</p>"},m.prototype.parseFootnote=function(b,c){c[0];var c=c[1],c=this.footnotes.indexOf(c);return 0<=c&&((b=b.slice(0))[0]=b[0].replace(/^\[\^((?:[^\]]|\]|\[)+?)\]:/,""),this.footnotes[c]=b),""},m.prototype.parseDefinition=function(){return""},m.prototype.parseHtml=function(b,d,f){var c;return b=b.map((c=this,function(e){return c.parseInline(e,null!=c.specialWhiteList[d]?c.specialWhiteList[d]:"")})),this.markLines(b,f).join("\n")},m.prototype.cleanUrl=function(b){var c=new RegExp("^\\s*((http|https|ftp|mailto):["+n+"_a-z0-9-:\\.\\*/%#;!@\\?\\+=~\\|\\,&\\(\\)]+)","i"),d=new RegExp("^\\s*(["+n+"_a-z0-9-:\\.\\*/%#!@\\?\\+=~\\|\\,&]+)","i");return(c=b.match(c))||(c=b.match(d))?c[1]:"#"},m.prototype.escapeBracket=function(b){return a(["\\[","\\]","\\(","\\)"],["[","]","(",")"],b)},m.prototype.startBlock=function(b,c,d){return null==d&&(d=null),this.pos+=1,this.current=b,this.blocks.push([b,c,c,d]),this},m.prototype.endBlock=function(){return this.current="normal",this},m.prototype.isBlock=function(b,c){return null==c&&(c=null),this.current===b&&(null===c||this.blocks[this.pos][3]===c)},m.prototype.getBlock=function(){return null!=this.blocks[this.pos]?this.blocks[this.pos]:null},m.prototype.setBlock=function(b,c){return null==b&&(b=null),null==c&&(c=null),null!==b&&(this.blocks[this.pos][2]=b),null!==c&&(this.blocks[this.pos][3]=c),this},m.prototype.backBlock=function(b,d,f){var c;return null==f&&(f=null),this.pos<0?this.startBlock(d,0,f):(c=this.blocks[this.pos][2],this.blocks[this.pos][2]=c-b,f=[d,c-b+1,c,f],this.blocks[this.pos][1]<=this.blocks[this.pos][2]?(this.pos+=1,this.blocks.push(f)):this.blocks[this.pos]=f,this.current=d,this)},m.prototype.combineBlock=function(){var b,c;return this.pos<1||(c=this.blocks[this.pos-1].slice(0),b=this.blocks[this.pos].slice(0),c[2]=b[2],this.blocks[this.pos-1]=c,this.current=c[0],this.blocks=this.blocks.slice(0,-1),--this.pos),this},q=m,"undefined"!=typeof module&&null!==module?module.exports=q:"undefined"!=typeof window&&null!==window&&(window.HyperDown=q)}).call(this);